# 09. npm æ”¯æŒ



## 9.1 é»˜è®¤æ„å»º npm



ç›®å‰å°ç¨‹åºå·²ç»æ”¯æŒä½¿ç”¨ npm å®‰è£…ç¬¬ä¸‰æ–¹åŒ…ï¼Œä½†æ˜¯è¿™äº› npm åŒ…åœ¨å°ç¨‹åºä¸­ä¸èƒ½å¤Ÿç›´æ¥ä½¿ç”¨ï¼Œå¿…é¡»å¾—ä½¿ç”¨å°ç¨‹åºå¼€å‘è€…å·¥å…·è¿›è¡Œæ„å»ºåæ‰å¯ä»¥ä½¿ç”¨ã€‚



> ğŸ“Œ **æ³¨æ„äº‹é¡¹**ï¼š
>
> â€‹		npm ç»™æä¾›äº†æ•°ä»¥ä¸‡è®¡çš„åŒ…ï¼Œä½†æ˜¯å› ä¸ºå°ç¨‹åºå®¿ä¸»ç¯å¢ƒæ˜¯å¾®ä¿¡ï¼Œä¹Ÿå°±æ˜¯è¯´å°ç¨‹åºæ˜¯è¿è¡Œåœ¨å¾®ä¿¡å†…éƒ¨ï¼Œå¹¶ä¸æ˜¯æµè§ˆå™¨ä¸­ï¼Œå› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰çš„åŒ…éƒ½èƒ½å¤Ÿåº”ç”¨åœ¨å¼€å‘ä»¥åŠç”Ÿäº§ç¯å¢ƒä¸­ï¼Œåœ¨ä½¿ç”¨çš„ npm çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§åŒ…æˆ‘ä»¬ä¸èƒ½å¤Ÿä½¿ç”¨ï¼š
>
> 1. ä¸èƒ½å¤Ÿä½¿ç”¨ä¾èµ– Node.js å†…ç½®åº“çš„åŒ…ï¼Œå³å®‰è£…çš„ä¾èµ–å†…éƒ¨ä½¿ç”¨äº† Node æ ¸å¿ƒæ¨¡å—çš„åŒ…ä¸èƒ½å¤Ÿå®‰è£…ä½¿ç”¨
> 2. ä¸èƒ½å¤Ÿä½¿ç”¨ä¾èµ– æµè§ˆå™¨å†…ç½®å¯¹è±¡çš„åŒ…ï¼Œå› ä¸ºåœ¨å°ç¨‹åºä¸­ä¸å­˜åœ¨ DOM ã€BOM
> 3. ä¸èƒ½å¤Ÿä½¿ç”¨ä¾èµ– C++ æ’ä»¶çš„åŒ…



æˆ‘ä»¬ä»¥ä½¿ç”¨ [mobx-miniprogram](https://github.com/wechat-miniprogram/mobx) å°ç¨‹åºçš„ MobX ç»‘å®šè¾…åŠ©åº“ä¸ºä¾‹ï¼Œæ¥è¯´æ˜å°ç¨‹åºä¸­å¦‚ä½•å®‰è£…å’Œæ„å»º npmï¼Œä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š



1. åˆå§‹åŒ– `package.json`
2. é€šè¿‡ `npm` å®‰è£…é¡¹ç›®ä¾èµ–
3. é€šè¿‡å¾®ä¿¡å¼€å‘è€…å·¥å…·æ„å»º `npm`



> ğŸ“Œ **æ³¨æ„äº‹é¡¹**ï¼š
>
> node_modules ç›®å½•ä¸‹çš„åŒ…ï¼Œä¸ä¼šå‚ä¸å°ç¨‹åºé¡¹ç›®çš„ç¼–è¯‘ã€ä¸Šä¼ å’Œæ‰“åŒ…ï¼Œå› æ­¤ã€‚åœ¨å°ç¨‹åºé¡¹ç›®ä¸­è¦æƒ³ä½¿ç”¨ npm åŒ…ï¼Œå¿…é¡»èµ°ä¸€é "æ„å»º npm" çš„è¿‡ç¨‹ï¼Œ
>
> åœ¨æ„å»ºæˆåŠŸä»¥åï¼Œ**é»˜è®¤**ä¼šåœ¨å°ç¨‹åºé¡¹ç›®æ ¹ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ node_modules åŒçº§ç›®å½•ä¸‹ç”Ÿæˆ miniprogram_npm ç›®å½•ï¼Œé‡Œé¢å­˜æ”¾è¿™æ„å»ºæ‰“åŒ…åçš„ npm åŒ…ï¼Œä¹Ÿå°±æ˜¯å°ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çœŸæ­£ä½¿ç”¨çš„åŒ…





**è¯¦ç»†æ­¥éª¤ï¼š**



1. åˆå§‹åŒ– `package.json`ï¼Œ**è¿™ä¸€æ­¥è‡³å…³é‡è¦ï¼Œè¦ä¸ç„¶åç»­çš„æ­¥éª¤éƒ½å¾ˆéš¾è¿›è¡Œä¸‹å»**

   ```shell
   npm init -y
   ```

   

2. é€šè¿‡ npm å®‰è£… `@vant/weapp` åŒ…

   ```shell
   npm install --save mobx-miniprogram mobx-miniprogram-bindings
   ```

   

3. æ„å»º npmã€‚



4. æ„å»ºæˆåŠŸåï¼Œå³å¯ä½¿ç”¨å®‰è£…çš„ä¾èµ–ï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»º `store/index.js` æ–‡ä»¶

   ```js
   import { observable } from 'mobx-miniprogram'
   
   export const store = observable({
     // å…¨å±€å…±äº«çš„æ•°æ®
     numA: 1,
     numB: 1
   })
   
   ```

   

5. åœ¨ `pages/home/home.js` ä¸­å¼•å…¥ `store` æ–‡ä»¶ï¼Œæµ‹è¯•æ–‡ä»¶æ˜¯å¦æ­£å¸¸ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œè¯´æ˜ä¾èµ–ä½¿ç”¨æˆåŠŸã€‚

   ```js
   import { store } from '../../store/index.js'
   
   Page({
     // coding...
   })
   ```

   



## 9.2 è‡ªå®šä¹‰æ„å»º  npm



åœ¨å®é™…å¼€å‘ä¸­ï¼Œå› ä¸ºé¡¹ç›®æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¯¹å°ç¨‹åºçš„å¼€å‘ç›®å½•è¿›è¡Œè°ƒæ•´ï¼Œå°ç¨‹åºæä¾›äº†è‡ªå®šä¹‰æ„å»º npm çš„æ–¹å¼ï¼Œå…è®¸å¼€å‘è€…åœ¨ `project.config.json` ä¸­æŒ‡å®š `node_modules` çš„ä½ç½® å’Œ ç›®æ ‡ `miniprogram_npm` çš„ä½ç½®ï¼Œä»è€Œæ›´å¥½çš„ä¼˜åŒ–ç›®å½•ç»“æ„ï¼Œæ›´å¥½çš„ç®¡ç†é¡¹ç›®ä¸­çš„ä»£ç ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š



1. éœ€è¦é€šè¿‡ `miniprogramRoot` æŒ‡å®šè°ƒæ•´åäº†çš„å°ç¨‹åºå¼€å‘ç›®å½•
2. é…ç½® project.config.json çš„ `setting.packNpmManually` ä¸º `true`ï¼Œå¼€å¯è‡ªå®šä¹‰ node_modules å’Œ miniprogram_npm ä½ç½®çš„æ„å»º npm æ–¹å¼
3. é…ç½® project.config.json çš„ `setting.packNpmRelationList` é¡¹ï¼ŒæŒ‡å®š `packageJsonPath` å’Œ `miniprogramNpmDistDir` çš„ä½ç½®



**è¯¦ç»†æ„å»ºè¿‡ç¨‹ï¼š**



1. åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»º `miniprogram` ç›®å½•ï¼Œå°†å’Œå°ç¨‹åºå¼€å‘æœ‰å…³çš„ç›®å½•æ‹–æ‹½è¿›å…¥

   - ç§»é™¤ `node_modules` å’Œ `miniprogram_npm`


   

2. åœ¨ `project.config.json` ä¸­é€šè¿‡ `miniprogramRoot` å±æ€§æŒ‡å®šè°ƒæ•´åäº†çš„å°ç¨‹åºå¼€å‘ç›®å½•

   ```json
   {
     "miniprogramRoot": "miniprogram/"
   }
   ```

   

3. é…ç½® project.config.json çš„ `setting.packNpmManually` ä¸º `true`ï¼Œå¼€å¯è‡ªå®šä¹‰ node_modules å’Œ miniprogram_npm ä½ç½®çš„æ„å»º npm æ–¹å¼

   ```js
   {
     "setting": {
       "packNpmManually": true
     }
   }
   ```

   

4. é…ç½® project.config.json çš„ `setting.packNpmRelationList` é¡¹ï¼ŒæŒ‡å®š `packageJsonPath` å’Œ `miniprogramNpmDistDir` çš„ä½ç½®

   ```json
   {
     "setting": {
       "packNpmManually": true,
       "packNpmRelationList": [
         {
           "packageJsonPath": "./package.json",
           "miniprogramNpmDistDir": "./miniprogram"
         }
       ]
     }
   }
   ```

   

5. é‡æ–°ä¸‹è½½å®‰è£…ä¾èµ–ï¼Œç„¶åé‡æ–°æ„å»º npm

   - å¦‚æœæ„å»ºå¤±è´¥ï¼Œå¯ä»¥é€‰æ‹©æ¸…é™¤ç¼“å­˜æˆ–è€…é‡å¯å¾®ä¿¡å¼€å‘è€…å·¥å…·
